<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v4.0.1">
    <title>l7mp.io</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/carousel/">

    <!-- Bootstrap core CSS -->
    <link href="../assets/dist/css/bootstrap.css" rel="stylesheet">

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>
    <!-- Custom styles for this template -->
    <link href="../assets/documents.css" rel="stylesheet">
    <link href="../assets/main.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- FAVICO -->
  <link rel="icon" href="../assets/brand/logo.svg">
</head>

<body>
    <div id="container">
        <header><nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"></span><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   sodipodi:docname="logo.svg"
   inkscape:version="0.92.5 (2060ec1f9f, 2020-04-08)"
   id="svg8"
   version="1.1"
   viewBox="0 0 69.859449 39.077042"
   height="39.077042px"
   width="69.859451px"
   inkscape:export-filename="/home/richard/Desktop/logo.png"
   inkscape:export-xdpi="96"
   inkscape:export-ydpi="96">
  <defs
     id="defs2">
    <rect
       id="rect118"
       height="66.02002"
       width="62.544495"
       y="207.00511"
       x="94.25029" />
    <rect
       id="rect108"
       height="36.839436"
       width="71.237389"
       y="160.67441"
       x="106.99679" />
    <rect
       id="rect44"
       height="68.213699"
       width="177.64281"
       y="93.610863"
       x="12.609511" />
  </defs>
  <sodipodi:namedview
     fit-margin-bottom="0"
     fit-margin-right="0"
     fit-margin-left="0"
     fit-margin-top="0"
     inkscape:window-maximized="1"
     inkscape:window-y="1080"
     inkscape:window-x="278"
     inkscape:window-height="731"
     inkscape:window-width="1366"
     showgrid="false"
     inkscape:document-rotation="0"
     inkscape:current-layer="layer1"
     inkscape:document-units="mm"
     inkscape:cy="13.61354"
     inkscape:cx="37.648299"
     inkscape:zoom="8.0000004"
     inkscape:pageshadow="2"
     inkscape:pageopacity="0.0"
     borderopacity="1.0"
     bordercolor="#666666"
     pagecolor="#ffffff"
     id="base" />
  <metadata
     id="metadata5">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title></dc:title>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     transform="translate(-11.637504,-110.9267)"
     style="display:inline"
     id="layer1"
     inkscape:groupmode="layer"
     inkscape:label="Layer 1">
    <text
       style="font-style:normal;font-weight:normal;font-size:10.58329964px;line-height:1.25;font-family:sans-serif;white-space:pre;shape-inside:url(#rect44);fill:#000000;fill-opacity:1;stroke:none"
       id="text42"
       xml:space="preserve" />
    <text
       style="font-style:normal;font-weight:normal;font-size:10.58329964px;line-height:1.25;font-family:sans-serif;white-space:pre;shape-inside:url(#rect108);fill:#000000;fill-opacity:1;stroke:none"
       id="text106"
       xml:space="preserve" />
    <text
       style="font-style:normal;font-weight:normal;font-size:10.58329964px;line-height:1.25;font-family:sans-serif;white-space:pre;shape-inside:url(#rect118);fill:#000000;fill-opacity:1;stroke:none"
       id="text116"
       xml:space="preserve" />
    <text
       id="text33"
       y="40.511105"
       x="54.470467"
       style="font-style:normal;font-weight:normal;font-size:10.58329964px;line-height:1.25;font-family:sans-serif;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.26458299"
       xml:space="preserve"><tspan
         style="font-size:35.27780151px;stroke-width:0.26458299"
         y="49.874844"
         x="54.470467"
         id="tspan31"
         sodipodi:role="line" /></text>
    <path
       inkscape:connector-curvature="0"
       id="path956-3"
       style="display:inline;fill:#1e90ff;fill-opacity:1;stroke:none;stroke-width:0.0408072;stroke-opacity:1"
       d="m 40.702489,110.9267 -8.998108,0.003 -8.997538,0.001 -1.897875,2.39141 c -1.043647,1.31479 -3.236111,4.07257 -4.872196,6.12851 -4.372088,5.4941 -4.320204,5.42754 -4.294979,5.55132 0.02824,0.13856 2.465551,10.79939 3.272039,14.31147 0.34843,1.51733 0.650329,2.78962 0.670575,2.82746 0.07337,0.13704 2.654511,1.42861 8.346318,4.17543 6.561176,3.16634 7.725956,3.71427 7.836844,3.68646 0.213219,-0.0536 15.578395,-7.4507 15.858685,-7.63476 0.117525,-0.0773 0.163037,-0.14476 0.212327,-0.31423 0.206979,-0.71199 1.953742,-8.31372 3.10639,-13.51908 0.74085,-3.34566 0.772124,-3.4982 0.742298,-3.617 -0.05532,-0.22043 -1.63454,-2.23901 -8.638908,-11.04286 z" />
    <path
       sodipodi:nodetypes="ccccscccsccccsccccccsccc"
       inkscape:connector-curvature="0"
       id="path829-6"
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:26.43350029px;line-height:1.25;font-family:HamburgerHeaven;-inkscape-font-specification:'HamburgerHeaven, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;display:inline;fill:#ffffff;fill-opacity:1;stroke:#1e90ff;stroke-width:0.91209394;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
       d="m 66.016442,125.37447 -3.417453,15.28467 c -0.08453,0.45625 -0.182917,1.16916 0.525003,1.1906 l -0.475513,2.15597 h -1.474982 c -1.051159,0 -1.88779,-0.2789 -2.509907,-0.83665 -0.622112,-0.55775 -0.640371,-1.25316 -0.386435,-2.50992 l 3.459583,-15.54209 c 0.444992,-1.72559 -0.396865,-2.5099 -1.641087,-2.5099 h -1.866339 l -4.751629,21.39856 H 49.16579 l 4.114206,-18.88866 c 0.369872,-1.64557 -0.0062,-2.5099 -1.293268,-2.5099 H 50.12039 l -4.719455,21.39856 h -4.311883 l 4.751628,-21.55945 h -1.530669 l 0.46879,-2.15595 h 15.509915 c 1.694726,0 3.078392,0.41832 4.150998,1.25495 1.17987,0.92244 1.705447,2.19884 1.576735,3.82921 z" />
    <path
       sodipodi:nodetypes="cccsccccccsccccsccccc"
       inkscape:connector-curvature="0"
       id="path831-7"
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:26.43350029px;line-height:1.25;font-family:HamburgerHeaven;-inkscape-font-specification:'HamburgerHeaven, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;display:inline;fill:#ffffff;fill-opacity:1;stroke:#1e90ff;stroke-width:0.91213602;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
       d="m 81.02402,124.90133 -0.85977,3.86139 c -0.376253,1.56124 -0.515623,2.20583 -1.231817,3.50743 -0.87631,1.16709 -2.263208,1.82462 -3.636139,1.82462 h -4.375519 l -2.154706,9.91093 h -4.311887 l 4.696057,-21.55947 H 67.65319 l 0.435167,-2.15593 h 8.398532 c 1.372936,0 2.499174,0.11682 3.378716,1.10362 0.879538,0.96531 1.265679,2.13447 1.158415,3.50741 z m -4.21535,-0.23479 c 0.06435,-0.60069 -0.107261,-1.11553 -0.514853,-1.54457 -0.386141,-0.45048 -0.890265,-0.67574 -1.512378,-0.67574 h -1.351487 l -1.993317,9.52476 h 2.50817 c 1.494745,-0.0105 1.351746,-0.77957 1.754333,-2.301 z" />
    <g
       transform="matrix(-1.2173289,0,0,-1.3621348,64.605728,299.63255)"
       id="g24-5"
       style="font-style:normal;font-weight:normal;font-size:7.92999983px;line-height:0;font-family:sans-serif;display:inline;fill:#ffffff;fill-opacity:1;stroke:#1e90ff;stroke-width:0.70831352;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
       aria-label="7 ">
      <path
         sodipodi:nodetypes="ccccccc"
         inkscape:connector-curvature="0"
         id="path22-3"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:26.4333992px;line-height:0.94999999;font-family:HamburgerHeaven;-inkscape-font-specification:'HamburgerHeaven, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;fill:#ffffff;fill-opacity:1;stroke:#1e90ff;stroke-width:0.70831352;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         d="m 36.043232,114.2715 -4.027742,18.08045 h -3.568509 l 3.393341,-15.30705 h -6.030795 l 0.374047,-2.7734 z" />
    </g>
    <g
       aria-label="7 "
       style="font-style:normal;font-weight:normal;font-size:7.92999983px;line-height:0;font-family:sans-serif;display:inline;fill:#ffffff;fill-opacity:1;stroke:#1e90ff;stroke-width:0.70831352;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
       id="g834"
       transform="matrix(1.2173289,0,0,1.3621348,-0.56896995,-40.45509)">
      <path
         d="m 36.043232,114.2715 -4.027742,18.08045 h -3.568509 l 3.393341,-15.30705 h -6.030795 l 0.374047,-2.7734 z"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:26.4333992px;line-height:0.94999999;font-family:HamburgerHeaven;-inkscape-font-specification:'HamburgerHeaven, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;fill:#ffffff;fill-opacity:1;stroke:#1e90ff;stroke-width:0.70831352;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         id="path832"
         inkscape:connector-curvature="0"
         sodipodi:nodetypes="ccccccc" />
    </g>
    <rect
       style="display:inline;fill:#ffffff;fill-rule:evenodd;stroke-width:1.01229036"
       id="rect873"
       width="0.15417291"
       height="0.21754521"
       x="-36.763924"
       y="116.96698"
       transform="matrix(0.78276816,-0.62231343,0.6196037,0.78491481,0,0)" />
  </g>
</svg>

    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse"
        aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav mr-auto">
            
            <li class="nav-item active">
                
                    <a class="nav-link" href="/about"><span>About</span></a>
                
            </li>
            
            <li class="nav-item active">
                
                    <a class="nav-link" href="/docs"><span>Documentation</span></a>
                
            </li>
            
            <li class="nav-item active">
                
                    <a class="nav-link" href="/news"><span>News</span></a>
                
            </li>
            
            <li class="nav-item active">
                
                    <a class="nav-link" href="/faq"><span>FAQ</span></a>
                
            </li>
            
            <li class="nav-item active">
                
                    <a class="nav-link" href="/openapi" target="_blank"><span>OpenAPI</span></a>
                
            </li>
            
            <li class="nav-item active">
                
                    <a class="nav-link" href="https://github.com/l7mp/l7mp"><span>GitHub</span></a>
                
            </li>
            
        </ul>
        <form class="form-inline mt-2 mt-md-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
            <button class="btn btn-primary my-2 my-sm-0" type="submit">Search</button>
        </form>
    </div>
</nav></header>
        <div id="body">
            <div class="container-fluid">
                <div class="row">
                    <div id="accordion" class="col-md-3 col-lg-2">
  
    
    
    
      
        <div class="card">
          
          <div class="card-header" id="heading1">
            <h5 class="mb-0">
              <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapse1"
                aria-expanded="false" aria-controls="collapse1">
                Overview
              </button>
            </h5>
          </div>
          
                
              <div id="collapse1" class="collapse" aria-labelledby="heading1" data-parent="#accordion">
                <div class="card-body">
                  <ul id="items" style="list-style-type:none;">
                    
                      <li><a href="/docs/l7mp_overview#what-is-l7mp">What is l7mp?</a></li>
                    
                      <li><a href="/docs/l7mp_overview#the-l7mp-data-plane">Data plane: The l7mp proxy</a></li>
                    
                      <li><a href="/docs/l7mp_overview#the-l7mp-control-plane">Control plane: The l7mp service mesh</a></li>
                    
                      <li><a href="/docs/l7mp_overview#deployment-models">Deployment models</a></li>
                    
                      <li><a href="/docs/l7mp_overview#features">Features</a></li>
                    
                      <li><a href="/docs/l7mp_overview#contributing">Contributing</a></li>
                    
                  </ul>
                </div>
              </div>
            
          
        </div>
      
        <div class="card">
          
          <div class="card-header" id="heading2">
            <h5 class="mb-0">
              <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapse2"
                aria-expanded="false" aria-controls="collapse2">
                Getting started
              </button>
            </h5>
          </div>
          
                
              <div id="collapse2" class="collapse" aria-labelledby="heading2" data-parent="#accordion">
                <div class="card-body">
                  <ul id="items" style="list-style-type:none;">
                    
                      <li><a href="/docs/l7mp_getting_started#using-the-l7mp-proxy-in-standalone-mode">Using the l7mp proxy in standalone mode</a></li>
                    
                      <li><a href="/docs/l7mp_getting_started#using-the-l7mp-service-mesh">Using the l7mp service mesh</a></li>
                    
                  </ul>
                </div>
              </div>
            
          
        </div>
      
        <div class="card">
          
          <div class="card-header" id="heading3">
            <h5 class="mb-0">
              <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapse3"
                aria-expanded="false" aria-controls="collapse3">
                The l7mp proxy
              </button>
            </h5>
          </div>
          
                
              <div id="collapse3" class="collapse" aria-labelledby="heading3" data-parent="#accordion">
                <div class="card-body">
                  <ul id="items" style="list-style-type:none;">
                    
                      <li><a href="/docs/l7mp_proxy#concepts">Concepts</a></li>
                    
                      <li><a href="/docs/l7mp_proxy#reference">Reference</a></li>
                    
                      <li><a href="/docs/l7mp_proxy#tasks">Tasks</a></li>
                    
                  </ul>
                </div>
              </div>
            
          
        </div>
      
        <div class="card">
          
          <div class="card-header" id="heading4">
            <h5 class="mb-0">
              <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapse4"
                aria-expanded="false" aria-controls="collapse4">
                The l7mp service mesh
              </button>
            </h5>
          </div>
          
                
              <div id="collapse4" class="collapse" aria-labelledby="heading4" data-parent="#accordion">
                <div class="card-body">
                  <ul id="items" style="list-style-type:none;">
                    
                      <li><a href="/docs/l7mp_service_mesh#concepts">Concepts</a></li>
                    
                      <li><a href="/docs/l7mp_service_mesh#reference">Reference</a></li>
                    
                      <li><a href="/docs/l7mp_service_mesh#tasks">Tasks</a></li>
                    
                  </ul>
                </div>
              </div>
            
          
        </div>
      
    
  
</div>
                    <main role="main" class="col-md-6 col-lg-8 px-md-4">
                        <div class="d-flex justify-content-start">
                            <article style="padding-bottom:6rem;">
                                <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
                                    <ol class="breadcrumb spb-1" style="background: #FFF;">
                                      
                                      
                                      
                                      <li class="breadcrumb-item">
                                        <a
                                          href="http://localhost:4000/docs/">Documentation</a>
                                      </li>
                                      
                                      <li class="breadcrumb-item active" aria-current="page">
                                        <a href="http://localhost:4000/docs/l7mp_getting_started">Getting started</a>
                                      </li>
                                      
                                    </ol>
                                  </nav>
                                <h2 id="using-the-l7mp-proxy-in-standalone-mode">Using the l7mp proxy in standalone mode</h2>

<h3 id="standalone-installation">Standalone installation</h3>

<p>Use the below to install the l7mp proxy from the official l7mp distribution at <a href="https://npmjs.org">npm.js</a>.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>l7mp <span class="nt">--save</span>
npm <span class="nb">test</span>
</code></pre></div></div>

<p>At least Node.js v14 is required.</p>

<h3 id="docker-installation">Docker installation</h3>

<p>Pull the official image by <code class="language-plaintext highlighter-rouge">docker pull l7mp/l7mp:latest</code> or use the enclosed Dockerfile to deploy the l7mp proxy.</p>

<h3 id="deploy-into-kubernetes">Deploy into Kubernetes</h3>

<p>Use the below configuration to deploy l7mp as an ingress gateway in your Kubernetes cluster.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">DaemonSet</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">l7mp-ingress-gw</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">l7mp-ingress-gw</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">l7mp-ingress-gw</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">l7mp-ingress-gw</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">l7mp-ingress-gw-config</span>
          <span class="na">configMap</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">l7mp-ingress-gw</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">l7mp</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">l7mp/l7mp:latest</span>
        <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
        <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span> <span class="s2">"</span><span class="s">node"</span> <span class="pi">]</span>
        <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span> <span class="s2">"</span><span class="s">l7mp-proxy.js"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-c"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">config/l7mp-ingress-gw.yaml"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-s"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-l"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">info"</span> <span class="pi">]</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">1234</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">l7mp-ingress-gw-config</span>
            <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/app/config</span>
      <span class="na">hostNetwork</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">dnsPolicy</span><span class="pi">:</span> <span class="s">ClusterFirstWithHostNet</span>

<span class="nn">---</span>

<span class="c1"># Controller listening on 1234</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">l7mp-ingress-gw</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="s">l7mp-ingress-gw.yaml</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">admin:</span>
      <span class="s">log_level: info</span>
      <span class="s">log_file: stdout</span>
      <span class="s">access_log_path: /tmp/admin_access.log</span>
    <span class="s">listeners:</span>
      <span class="s">- name: controller-listener</span>
        <span class="s">spec: { protocol: HTTP, port: 1234 }</span>
        <span class="s">rules:</span>
          <span class="s">- action:</span>
              <span class="s">route:</span>
                <span class="s">cluster:</span>
                  <span class="s">spec: { protocol: L7mpController }</span>
</code></pre></div></div>

<h3 id="run">Run</h3>

<p>The below usage examples assume that the l7mp proxy is deployed in standalone mode and it is available on the <code class="language-plaintext highlighter-rouge">localhost</code>.</p>

<p>Run l7mp locally with a <a href="config/l7mp-minimal.yaml">sample</a> static configuration.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node l7mp-proxy.js <span class="nt">-c</span> config/l7mp-minimal.yaml <span class="nt">-l</span> warn <span class="nt">-s</span>
</code></pre></div></div>

<p>Configuration is accepted either in YAML format (if the extension is <code class="language-plaintext highlighter-rouge">.yaml</code>) or JSON (otherwise). Command line arguments override static configuration parameters.</p>

<h3 id="query-configuration">Query configuration</h3>

<p>The sample configuration will fire up a HTTP listener on port 1234 and route it to the l7mp controller that serves the l7mp REST API. This API can be used to query or configure the proxy on the fly; e.g., the below will dump the full configuration in JSON format:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl http://localhost:1234/api/v1/config
</code></pre></div></div>

<p>For a list of all REST API endpoints, see the <a href="https://l7mp.io/openapi">l7mp OpenAPI specs</a>.</p>

<h3 id="manage-sessions">Manage sessions</h3>

<p>On top of the static configuration, the response contains a list of <code class="language-plaintext highlighter-rouge">sessions</code>, enumerating the set of active (connected) streams inside l7mp. You can list the live sessions explicitly as follows:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl http://localhost:1234/api/v1/sessions
</code></pre></div></div>

<p>You should see only a single HTTP session: this session was created by the l7mp proxy to route the REST API query from the HTTP listener to the controller endpoint and this session happens to be active when the session list request is issued.</p>

<p>You can also delete any session (suppose its name is <code class="language-plaintext highlighter-rouge">session-name</code>) via the below REST API call.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-iX</span> DELETE http://localhost:1234/api/v1/sessions/&lt;session-name&gt;
</code></pre></div></div>

<h3 id="add-a-new-cluster">Add a new cluster</h3>

<p>Add a new WebSocket <em>cluster</em> named <code class="language-plaintext highlighter-rouge">ws-cluster</code> that will connect to an upstream WebSocket service with a single <em>endpoint</em> at <code class="language-plaintext highlighter-rouge">localhost:16000</code>.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-iX</span> POST <span class="nt">--header</span> <span class="s1">'Content-Type:text/x-yaml'</span> <span class="nt">--data-binary</span> @- <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">  http://localhost:1234/api/v1/clusters
cluster:
  name: ws-cluster
  spec: { protocol: "WebSocket", port: 16000 }
  endpoints:
    - spec: { address:  "127.0.0.1" }
</span><span class="no">EOF
</span></code></pre></div></div>

<p>Note that the REST API accepts both JSON and YAML configs (YAML will be converted to JSON internally). If multiple endpoints are added, l7mp will load-balance among these; e.g., the below will distribute connections across 3 upstream endpoints in proportion 3:1:1 and also implement sticky sessions, by applying consistent hashing on the source IP address of each connection.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-iX</span> POST <span class="nt">--header</span> <span class="s1">'Content-Type:text/x-yaml'</span> <span class="nt">--data-binary</span> @- <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">  http://localhost:1234/api/v1/clusters
cluster:
  name: ws-cluster-with-sticky-sessions
  spec: { protocol: "WebSocket", port: 16000 }
  endpoints:
    - spec: { address:  "127.0.0.1" }
      weight: 3
    - spec: { address:  "127.0.0.2" }
    - spec: { address:  "127.0.0.3" }
  loadbalancer:
    policy: "ConsistentHash"
    key: "IP/src_addr"
</span><span class="no">EOF
</span></code></pre></div></div>

<h3 id="add-a-new-listener-and-a-route">Add a new listener and a route</h3>

<p>Now add a new UDP <em>listener</em> called <code class="language-plaintext highlighter-rouge">udp-listener</code> at port 15000 that will accept connections from an IP address but only with source port 15001, and <em>route</em> the received connections to the above cluster (which, recall, we named as <code class="language-plaintext highlighter-rouge">ws-cluster</code>).</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-iX</span> POST <span class="nt">--header</span> <span class="s1">'Content-Type:text/x-yaml'</span> <span class="nt">--data-binary</span> @- <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">  http://localhost:1234/api/v1/listeners
listener:
  name: udp-listener
  spec: { protocol: UDP, port: 15000, connect: {port: 15001} }
  rules:
    - action:
        route:
          destination: ws-cluster
          ingress:
            - spec: { protocol: Logger }
          retry: {retry_on: always, num_retries: 3, timeout: 2000}
</span><span class="no">EOF
</span></code></pre></div></div>

<p>There is an important quirk here. The <code class="language-plaintext highlighter-rouge">route</code> spec in the above REST API call specifies a new cluster (the one with the protocol <code class="language-plaintext highlighter-rouge">Logger</code>), but this specification is embedded into the route definition. Here, <code class="language-plaintext highlighter-rouge">Logger</code> is a special <em>transform</em> cluster that will instruct l7mp to log all traffic arriving from the stream’s source (the UDP listener) to the destination (the WebSocket cluster) to the standard output. Of course, we could have added this cluster in a separate REST API call as well:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-iX</span> POST <span class="nt">--header</span> <span class="s1">'Content-Type:text/x-yaml'</span> <span class="nt">--data-binary</span> @- <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">  http://localhost:1234/api/v1/clusters
cluster:
  name: logger-cluster
  spec: { protocol: "Logger" }
</span><span class="no">EOF
</span></code></pre></div></div>

<p>And then we could let the route to simply refer to this cluster by name:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-iX</span> POST <span class="nt">--header</span> <span class="s1">'Content-Type:text/x-yaml'</span> <span class="nt">--data-binary</span> @- <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">  http://localhost:1234/api/v1/listeners
listener:
  name: udp-listener-with-no-embedded-cluster-def
  spec: { protocol: UDP, port: 15000, connect: {port: 15001} }
  rules:
    - action:
        route:
          destination: ws-cluster
          ingress:
            - logger-cluster
          retry: {retry_on: always, num_retries: 3, timeout: 2000}
</span><span class="no">EOF
</span></code></pre></div></div>

<p>This flexibility of l7mp to accept explicit and implicit (embedded) configurations is available in essentially all REST API calls, and it greatly simplifies the use of the API.</p>

<h3 id="routing">Routing</h3>

<p>On session creation, l7mp will demultiplex the bidirectional stream received at the listener into two uni-directional streams: the <em>ingress stream</em> (in the direction from the source/listener to the destination/cluster) will be routed through the <code class="language-plaintext highlighter-rouge">Logger</code> transform cluster. Theoretically, a transform cluster is free to apply any modification it wants to the traffic passing through it, it can be local (built into the l7mp datapath, like <code class="language-plaintext highlighter-rouge">Logger</code>) or remote (e.g., another WebSocket cluster), the only requirement is that the cluster endpoint listen at the specified address on the specified port and send the modified traffic back to l7mp. For now, the <code class="language-plaintext highlighter-rouge">Logger</code> cluster just dumps the content of the stream without transforming it in any ways, but you get the point. The returned stream is then piped to the cluster <code class="language-plaintext highlighter-rouge">ws-cluster</code>. In the <em>egress direction</em> (from the destination/cluster back to the source/listener), no transformation occurs as the egress chain spec is missing.</p>

<p>The ingress and the egress routes are specified and handled separately. Both routes can contain a list of any number of transform clusters that will be chained sequentially, automatically performing transparent protocol and payload conversion along the way. Note that datagram boundaries are preserved during transformation whenever possible, and when not (i.e., piping a UDP stream to a TCP cluster will lose segmentation), l7mp issues a warning.</p>

<p>The above should yield the routes:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ingress: udp-listener -&gt; logger-cluster -&gt; ws-cluster
egress:  ws-cluster -&gt; udp-listener
</code></pre></div></div>

<h3 id="retries-and-timeouts">Retries and timeouts</h3>

<p>Route specifications may contain a <code class="language-plaintext highlighter-rouge">retry</code> spec, in order to describe what to do when one of the connected endpoints fail. By the above spec, l7mp will automatically retry the connection at most 3 times both on connection setup errors and disconnect events on already established connections, waiting each time 2000 ms for the stream to be successfully re-established.</p>

<h3 id="test-the-connection">Test the connection</h3>

<p>To complete the connection, fire up a <code class="language-plaintext highlighter-rouge">socat(1)</code> sender (don’t forget to bind the sender to 15001, otherwise l7mp, which connects back to this port, will not accept the connection):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>socat - udp:localhost:15000,sourceport<span class="o">=</span>15001
</code></pre></div></div>

<p>Then <a href="https://github.com/vi/websocat">start</a> a <code class="language-plaintext highlighter-rouge">websocat</code> receiver:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>websocat <span class="nt">-Eb</span> ws-l:127.0.0.1:16000 -
</code></pre></div></div>

<p>What you type in the sender should now appear at the receiver verbatim, and the l7mp proxy should report everything that passes from the sender to the receiver on the standard output. Note that in the reverse direction, i.e., from the receiver to the sender, nothing will be logged, since the <code class="language-plaintext highlighter-rouge">Logger</code> was added to the <em>ingress route</em> only but not to the <em>egress route</em>.</p>

<h3 id="clean-up">Clean up</h3>

<p>Provided that the new session is named <code class="language-plaintext highlighter-rouge">session-name</code> (l7mp automatically assigns a unique name to each session, you can check this by issuing a GET request to the API endpoint <code class="language-plaintext highlighter-rouge">/api/v1/sessions</code>), you can delete this session as follows:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-iX</span> DELETE http://localhost:1234/api/v1/sessions/&lt;session-name&gt;
</code></pre></div></div>

<p>In addition, use the below to remove the <code class="language-plaintext highlighter-rouge">udp-listener</code> and <code class="language-plaintext highlighter-rouge">ws-cluster</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-iX</span> DELETE http://localhost:1234/api/v1/listeners/udp-listener
curl <span class="nt">-iX</span> DELETE http://localhost:1234/api/v1/clusters/ws-cluster
</code></pre></div></div>

<p>Note however that this will delete <em>only</em> the named listener and the cluster even though, as mentioned above, these objects may contain several <em>embedded</em> objects; e.g., <code class="language-plaintext highlighter-rouge">udp-listener</code> contains and implicit <em>rulelist</em> (a match-action table) with a single match-all <em>rule</em>, plus a <em>route</em> and an embedded <em>cluster</em> spec (“Logger”), and these will not be removed by the above call.</p>

<p>You can use the below <code class="language-plaintext highlighter-rouge">recursive</code> version of the delete operations to delete all the embedded sub-objects of an object, but bear in mind that this will remove <em>everything</em> that was implciitly defined by <code class="language-plaintext highlighter-rouge">udp-listener</code> and <code class="language-plaintext highlighter-rouge">ws-cluster</code> and this includes <em>all</em> the sessions emitted by the listener and <em>all</em> the sessions routed via the cluster.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-iX</span> DELETE http://localhost:1234/api/v1/listeners/udp-listener?recursive<span class="o">=</span><span class="nb">true
</span>curl <span class="nt">-iX</span> DELETE http://localhost:1234/api/v1/clusters/ws-cluster?recursive<span class="o">=</span><span class="nb">true</span>
</code></pre></div></div>

<p>You can avoid this by not using embedded defs or, if this is too inconvenient, explicitly naming all embedded objects and then using the specific APIs (the RuleList API, Rule API, etc.) to clean up each object selectively.</p>

<h3 id="status">Status</h3>

<p>Below is a summary of the protocols supported by l7mp and the current status of the implementations.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Type</th>
      <th style="text-align: center">Protocol</th>
      <th style="text-align: center">Session ID</th>
      <th style="text-align: center">Type</th>
      <th style="text-align: center">Role</th>
      <th style="text-align: center">Mode</th>
      <th style="text-align: center">Re/Lb</th>
      <th style="text-align: center">Status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Remote</td>
      <td style="text-align: center">UDP</td>
      <td style="text-align: center">IP 5-tuple</td>
      <td style="text-align: center">datagram-stream</td>
      <td style="text-align: center">l/c</td>
      <td style="text-align: center">singleton/server</td>
      <td style="text-align: center">yes/yes</td>
      <td style="text-align: center">Full</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">TCP</td>
      <td style="text-align: center">IP 5-tuple</td>
      <td style="text-align: center">byte-stream</td>
      <td style="text-align: center">l/c</td>
      <td style="text-align: center">server</td>
      <td style="text-align: center">yes/yes</td>
      <td style="text-align: center">Full</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">HTTP</td>
      <td style="text-align: center">IP 5-tuple</td>
      <td style="text-align: center">byte-stream</td>
      <td style="text-align: center">l</td>
      <td style="text-align: center">server</td>
      <td style="text-align: center">yes/yes</td>
      <td style="text-align: center">Partial</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">WebSocket</td>
      <td style="text-align: center">IP 5-tuple + HTTP</td>
      <td style="text-align: center">datagram-stream</td>
      <td style="text-align: center">l/c</td>
      <td style="text-align: center">server</td>
      <td style="text-align: center">yes/yes</td>
      <td style="text-align: center">Full</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">JSONSocket</td>
      <td style="text-align: center">IP 5-tuple + JSON header</td>
      <td style="text-align: center">datagram-stream</td>
      <td style="text-align: center">l/c</td>
      <td style="text-align: center">server</td>
      <td style="text-align: center">yes/yes</td>
      <td style="text-align: center">Full</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">SCTP</td>
      <td style="text-align: center">IP 5-tuple</td>
      <td style="text-align: center">datagram-stream</td>
      <td style="text-align: center">l/c</td>
      <td style="text-align: center">server</td>
      <td style="text-align: center">yes/yes</td>
      <td style="text-align: center">TODO</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">AF_PACKET</td>
      <td style="text-align: center">file desc</td>
      <td style="text-align: center">datagram-stream</td>
      <td style="text-align: center">l/c</td>
      <td style="text-align: center">singleton</td>
      <td style="text-align: center">no/no</td>
      <td style="text-align: center">TODO</td>
    </tr>
    <tr>
      <td style="text-align: center">Local</td>
      <td style="text-align: center">STDIO-fork</td>
      <td style="text-align: center">N/A</td>
      <td style="text-align: center">byte-stream</td>
      <td style="text-align: center">c</td>
      <td style="text-align: center">singleton</td>
      <td style="text-align: center">no/no</td>
      <td style="text-align: center">Full</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">UNIX/stream</td>
      <td style="text-align: center">file desc/path</td>
      <td style="text-align: center">byte-stream</td>
      <td style="text-align: center">l/c</td>
      <td style="text-align: center">server</td>
      <td style="text-align: center">yes/yes</td>
      <td style="text-align: center">Full</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">UNIX/dgram</td>
      <td style="text-align: center">file desc/path</td>
      <td style="text-align: center">datagram-stream</td>
      <td style="text-align: center">l/c</td>
      <td style="text-align: center">singleton</td>
      <td style="text-align: center">no/no</td>
      <td style="text-align: center">TODO</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">PIPE</td>
      <td style="text-align: center">file desc/path</td>
      <td style="text-align: center">byte-stream</td>
      <td style="text-align: center">l/c</td>
      <td style="text-align: center">singleton</td>
      <td style="text-align: center">no/no</td>
      <td style="text-align: center">TODO</td>
    </tr>
    <tr>
      <td style="text-align: center">Transform</td>
      <td style="text-align: center">Stdio</td>
      <td style="text-align: center">N/A</td>
      <td style="text-align: center">byte-stream</td>
      <td style="text-align: center">c</td>
      <td style="text-align: center">singleton</td>
      <td style="text-align: center">yes/no</td>
      <td style="text-align: center">Full</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">Echo</td>
      <td style="text-align: center">N/A</td>
      <td style="text-align: center">datagram-stream</td>
      <td style="text-align: center">c</td>
      <td style="text-align: center">singleton</td>
      <td style="text-align: center">yes/no</td>
      <td style="text-align: center">Full</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">Discard</td>
      <td style="text-align: center">N/A</td>
      <td style="text-align: center">datagram-stream</td>
      <td style="text-align: center">c</td>
      <td style="text-align: center">singleton</td>
      <td style="text-align: center">yes/no</td>
      <td style="text-align: center">Full</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">Logger</td>
      <td style="text-align: center">N/A</td>
      <td style="text-align: center">datagram-stream</td>
      <td style="text-align: center">c</td>
      <td style="text-align: center">singleton</td>
      <td style="text-align: center">yes/no</td>
      <td style="text-align: center">Full</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">JSONENcap</td>
      <td style="text-align: center">N/A</td>
      <td style="text-align: center">datagram-stream</td>
      <td style="text-align: center">c</td>
      <td style="text-align: center">singleton</td>
      <td style="text-align: center">yes/no</td>
      <td style="text-align: center">Full</td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">JSONDecap</td>
      <td style="text-align: center">N/A</td>
      <td style="text-align: center">datagram-stream</td>
      <td style="text-align: center">c</td>
      <td style="text-align: center">singleton</td>
      <td style="text-align: center">yes/no</td>
      <td style="text-align: center">Full</td>
    </tr>
  </tbody>
</table>

<p>The standard protocols, like TCP, HTTP/1.1 and HTTP/2 (although only listener/server side at the moment), WebSocket, and Unix Domain Socket (of the byte-stream type, see below) are fully supported, and for plain UDP there are two modes available: in the “UDP singleton mode” l7mp acts as a “connected” UDP server that is statically tied/connected to a downstream remote IP/port pair, while in “UDP server mode” l7mp emits a new “connected” UDP session for each packet received with a new IP 5-tuple. In addition, JSONSocket is a very simple “UDP equivalent of WebSocket” that allows to enrich a plain UDP stream with arbitrary JSON encoded metadata; see the spec <a href="doc/jsonsocket-spec.org">here</a>. Finally, SCTP is a reliable message transport protocol widely used in telco applications and AF_PACKET would allow to send and receive raw L2/Ethernet or L3/IP packets on a stream; currently adding proper support for these protocols is a TODO.</p>

<p>Furthermore, there is a set of custom pseudo-protocols included in the l7mp proxy to simplify debugging and troubleshooting: the “Stdio” protocol makes it possible to pipe a stream to the l7mp proxy’s stdin/stdout, the “Echo” protocol implements a simple Echo server behavior which writes back everything it reads to the input stream, “Discard” simply blackholes everyting it receives, and finally “Logger” is like the Echo protocol but it also writes everything that goes through it to a file or to the standard output.  Finally, there are a couple of additional protocols (currently unimplemented) to further improve the usability of l7mp (see the equivalents in <code class="language-plaintext highlighter-rouge">socat(1)</code>): “STDIO-fork” is a protocol for communicating with a forked process through STDIO/STDOUT and PIPE uses standard UNIX pipes to do the same.</p>

<p>There are two <em>types</em> of streams supported by L7mp: a “byte-stream” (like TCP or Unix Domain Sockets in SOCK_STREAM mode) is a bidirectional stream that ignores segmentation/message boundaries, while “datagram-stream” is the same but it prefers segmentation/message boundaries whenever possible (e.g., UDP or WebSocket). The l7mp proxy warns if a datagram-stream type stream is routed to a byte-stream protocol, because this would lead to a loss of message segmentation. In addition, protocols may support any or both of the following two modes: a “singleton” mode protocol accepts only a single connection (e.g., a fully connected UDP listener will emit only a single session) while a “server” mode listener may accept multiple client connections, emitting a separate session for each connection received  (e.g., a TCP or a HTTP listener).</p>

<p>A protocol is marked with a flag <code class="language-plaintext highlighter-rouge">l</code> if it has a listener implementation in l7mp, acting as a server-side protocol “plug” that listens to incoming connections and emits new sessions, and with flag <code class="language-plaintext highlighter-rouge">c</code> if it implements the cluster side, i.e., the client-side of the protocol that can route a connection to an upstream service and load-balance across a set of remote endpoints, <code class="language-plaintext highlighter-rouge">Re</code> means that the protocol supports <em>retries</em> and <code class="language-plaintext highlighter-rouge">Lb</code> indicates that <em>load-balancing</em> support is also available for the protocol.</p>

<h2 id="using-the-l7mp-service-mesh">Using the l7mp service mesh</h2>

<p><img src="../assets/images/under-construction.png" alt="Under construction" width="50" /></p>

                            </article>
                        </div>
                    </main>
                    <div class="col-md-3 col-lg-2">
                        <div class="sticky">
                            <ul id="TOCPAGE" style="list-style-type:none;"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- <footer class="bg-dark site-footer">
    <div class="footer-container justify-content-center">
      <small>Copyright &copy; <a href="">l7mp.io</a></small>
    </div>
  </footer> -->
  <div id="footer" class="bg-dark text-white-50 container-fluid">
    <div class="row">
      <div class="col-md-4">
        <small>Authors:</small> </br>
        
          <small>Gábor Rétvári: rg0now@gmail.com</small></br> 
        
          <small>Felicián Németh: nemethf@github</small></br> 
        
          <small>Richárd Váradi: ricsi19981007@gmail.com</small></br> 
        
          <small>Kornél Dávid: konel1020@gmail.com</small></br> 
        
      </div>
      <div class="col-md-4">
        <small>Copyright &copy; <a href="">l7mp.io</a></small>
      </div>
      <div class="col-md-4">
        <small>Contact us</small> <br>
        <a href="#" class="fa fa-3x fa-github"></a>
        <a href="#" class="fa fa-3x fa-twitter"></a>
      </div>
    </div>
  </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../assets/js/vendor/jquery.slim.min.js"><\/script>')</script>
    <script src="../assets/dist/js/bootstrap.bundle.js"></script>
    <script src="../assets/sidebar.js"></script>
    <script src="../assets/main.js"></script>
    <script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>

<script>
$(document).ready(function() {
    var toc = $('#TOCPAGE');

    // Select each header
    sections = $('h1');
    console.log(sections);
        $.each(sections, function(idx, v) {
            section = $(v);
            var div_id = $(section).attr('id');
            var div_text = section.text().split('¶')[0];
            var parent = $("#" + div_id)
            var content = '<li id="link_' + div_id + '"><a href="#' + div_id + '" title="' + div_text +'">' + div_text +'</a></li>';
            $(toc).append(content);

            // Add section code to subnavigation
            var children = $('<ul style="list-style-type:none;"></ul>')
            var contenders = $("#" + div_id).nextUntil("h1");
            $.each(contenders, function(idx, contender){
               if($(contender).is('h2') || $(contender).is('h3')) {
                   console.log(contender);
                   var contender_id = $(contender).attr('id');
                   var contender_text = $(contender).text().split('¶')[0];
                   var content = '<li><a href="#' + contender_id + '" title="' + contender_text +'">' + contender_text +'</a></li>';
                   children.append(content);
                   console.log(children);
                }
             })
             $("#link_" + div_id).append(children);
        });
    });
</script>

       <!-- FOOTER -->
</body>

</html>